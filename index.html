<!DOCTYPE html>
<html lang="ja" data-theme="day">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SUGOMEMO</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <input type="file" id="editFileInput" accept="audio/*,video/*" hidden>
  <input type="file" id="imageFileInput" accept="image/*" multiple hidden>
  <input type="file" id="backupFileInput" accept=".json" hidden>

  <!-- バックアップ復元リスト -->
  <div class="backup-overlay" id="backupOverlay" hidden>
    <div class="backup-modal">
      <div class="backup-modal-header">
        <span class="backup-modal-title">復元するバックアップを選択</span>
        <button class="backup-modal-close" id="backupModalClose">&times;</button>
      </div>
      <div class="backup-modal-list" id="backupModalList"></div>
    </div>
  </div>

  <header class="header">
    <div class="header-left">
      <h1 class="logo">SUGOMEMO<span class="logo-version">v3.1</span></h1>
    </div>
    <nav class="tabs">
      <button class="tab active" data-tab="memo">
        <svg class="tab-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/></svg>
        <span class="tab-label">MEMO</span>
      </button>
      <button class="tab" data-tab="image">
        <svg class="tab-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
        <span class="tab-label">IMAGE</span>
      </button>
      <button class="tab" data-tab="edit">
        <svg class="tab-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="23 7 16 12 23 17 23 7"/><rect x="1" y="5" width="15" height="14" rx="2" ry="2"/><line x1="6" y1="2" x2="6" y2="5"/><line x1="10" y1="2" x2="10" y2="5"/></svg>
        <span class="tab-label">CUT</span>
      </button>
    </nav>
    <div class="header-right">
      <!-- Font Size -->
      <div class="font-size-group">
        <span class="font-size-title">SIZE</span>
        <button class="font-size-opt" data-size="0">1</button>
        <button class="font-size-opt" data-size="1">2</button>
        <button class="font-size-opt active" data-size="2">3</button>
        <button class="font-size-opt" data-size="3">4</button>
        <button class="font-size-opt" data-size="4">5</button>
      </div>
      <!-- Theme Toggle Switch -->
      <button class="theme-switch" id="themeToggle" aria-label="Toggle theme">
        <span class="theme-switch-label theme-switch-day">DAY</span>
        <span class="theme-switch-knob"></span>
        <span class="theme-switch-label theme-switch-night">NIGHT</span>
      </button>
    </div>
  </header>

  <main class="main">
    <!-- EDIT Section (Audio + Video unified) -->
    <section class="section" id="section-edit">
      <div class="edit-layout">
        <!-- Upper half: Preview + Drop -->
        <div class="edit-upper">
          <div class="edit-preview" id="editPreview">
            <video id="editVideo" playsinline muted></video>
            <div class="edit-drop-zone" id="editDropZone">
              <span class="drop-plus">+</span>
              <span class="drop-text">音声・動画ファイルをドロップ</span>
            </div>
          </div>
        </div>
        <!-- Lower half: Timeline + Controls -->
        <div class="edit-lower">
          <!-- Timeline area -->
          <div class="edit-timeline-area" id="editTimelineArea">
            <div class="edit-timeline-scroll" id="editTimelineScroll">
              <!-- Time ruler -->
              <div class="edit-ruler" id="editRuler">
                <canvas id="rulerCanvas"></canvas>
                <div class="playhead playhead-ruler" id="editPlayheadRuler"></div>
              </div>
              <!-- Video track -->
              <div class="edit-track" id="editVideoTrack">
                <div class="track-label" id="videoTrackLabel" data-track="video">
                  <span class="track-label-text">V</span>
                  <button class="track-mute-btn" id="videoMuteBtn" title="Vトラック無効">&times;</button>
                </div>
                <div class="track-content" data-track="video">
                  <canvas id="videoTrackCanvas"></canvas>
                  <div class="track-trim-overlay">
                    <div class="trim-dim trim-dim-left" id="videoDimLeft"></div>
                    <div class="trim-dim trim-dim-right" id="videoDimRight"></div>
                  </div>
                </div>
              </div>
              <!-- Audio track -->
              <div class="edit-track" id="editAudioTrack">
                <div class="track-label active" id="audioTrackLabel" data-track="audio">
                  <span class="track-label-text">A</span>
                  <button class="track-mute-btn" id="audioMuteBtn" title="Aトラック無効">&times;</button>
                </div>
                <div class="track-content" data-track="audio">
                  <canvas id="audioTrackCanvas"></canvas>
                  <div class="track-trim-overlay">
                    <div class="trim-dim trim-dim-left" id="audioDimLeft"></div>
                    <div class="trim-dim trim-dim-right" id="audioDimRight"></div>
                    <div class="volume-line" id="volumeLine" data-vol="100%"></div>
                  </div>
                </div>
              </div>
              <!-- Playhead + Trim handles overlay -->
              <div class="edit-timeline-overlay" id="editTimelineOverlay">
                <div class="playhead" id="editPlayhead"></div>
                <div class="trim-handle trim-handle-in" id="trimHandleIn">
                  <div class="trim-grip"></div>
                </div>
                <div class="trim-handle trim-handle-out" id="trimHandleOut">
                  <div class="trim-grip"></div>
                </div>
              </div>
            </div>
          </div>
          <!-- Zoom + Controls bar -->
          <div class="edit-controls-bar">
            <div class="edit-transport">
              <button class="btn btn-icon" id="editPrevFrame" title="1フレーム戻る (←)">&#9664;&#9664;</button>
              <button class="btn btn-circle" id="editPlayBtn" title="再生/停止 (Space)">
                <span class="icon-play"></span>
              </button>
              <button class="btn btn-icon" id="editNextFrame" title="1フレーム進む (→)">&#9654;&#9654;</button>
            </div>
            <div class="edit-time-display">
              <span class="time-track-badge" id="editTrackBadge">A</span>
              <span class="time-label">IN</span>
              <span class="time-value" id="editTimeIn">00:00.000</span>
              <span class="time-label">DUR</span>
              <span class="time-value" id="editTimeDur">00:00.000</span>
              <span class="time-label">OUT</span>
              <span class="time-value" id="editTimeOut">00:00.000</span>
            </div>
            <div class="edit-actions">
              <button class="btn btn-ghost btn-small" id="editMarkIn" title="I = In点">[ I</button>
              <button class="btn btn-ghost btn-small" id="editMarkOut" title="O = Out点">O ]</button>
              <button class="btn btn-icon btn-small" id="editZoomOut" title="縮小 (-)">−</button>
              <span class="zoom-level" id="editZoomLevel">×1</span>
              <button class="btn btn-icon btn-small" id="editZoomIn" title="拡大 (+)">+</button>
              <button class="btn btn-icon btn-small" id="editZoomFit" title="全体表示 (0)">全体</button>
              <button class="btn" id="editExportBtn">書き出し</button>
              <button class="btn btn-ghost btn-small" id="editResetBtn">リセット</button>
            </div>
          </div>
          <div class="shortcut-hints">
            <span><kbd>Space</kbd> 再生</span>
            <span><kbd>←</kbd><kbd>→</kbd> フレーム</span>
            <span><kbd>J</kbd><kbd>L</kbd> 5秒</span>
            <span><kbd>I</kbd> IN</span>
            <span><kbd>O</kbd> OUT</span>
            <span><kbd>Q</kbd><kbd>E</kbd> ズーム</span>
            <span><kbd>0</kbd> 全体</span>
            <span><kbd>Del</kbd> トラック消去</span>
          </div>
          <div class="edit-status" id="editStatus"></div>
        </div>
      </div>
    </section>

    <!-- IMAGE Section -->
    <section class="section" id="section-image">
      <div class="image-drop-zone" id="imageDropZone">
        <svg class="drop-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
        <span class="drop-text">ここに画像をドロップ、またはクリックして選択</span>
      </div>
      <div class="image-workspace" id="imageWorkspace" hidden>
        <div class="image-toolbar" id="imageToolbar">
          <!-- 1. サイズ設定 -->
          <div class="toolbar-section">
            <span class="toolbar-section-title">1. サイズ設定</span>
            <div class="toolbar-section-body">
              <select class="select" id="canvasSizePreset">
                <option value="custom">カスタム</option>
                <option value="500x500">正方形 (500×500)</option>
                <option value="1920x1080" selected>16:9 FHD (1920×1080)</option>
                <option value="3840x2160">16:9 4K (3840×2160)</option>
                <option value="1080x1920">9:16 FHD (1080×1920)</option>
                <option value="2160x3840">9:16 4K (2160×3840)</option>
                <option value="a4">A4 (210x297mm)</option>
                <option value="a3">A3 (297x420mm)</option>
                <option value="b5">B5 (182x257mm)</option>
                <option value="b4">B4 (257x364mm)</option>
                <option value="1080x1080">正方形 (1080×1080)</option>
                <option value="1920x200">バナー横 (1920×200)</option>
                <option value="200x1080">バナー縦 (200×1080)</option>
                <option value="1200x675">X公式 横長 (1200×675)</option>
                <option value="1200x1600">X公式 縦長 (1200×1600)</option>
                <option value="1080x1350">Instagram公式 (1080×1350)</option>
                <option value="1700x2400">Pixiv公式 漫画 (1700×2400)</option>
              </select>
              <select class="select" id="canvasOrientation">
                <option value="landscape">横</option>
                <option value="portrait">縦</option>
              </select>
              <label class="toolbar-label">W</label>
              <input type="number" class="toolbar-input" id="canvasWidthInput" value="1920" min="100" max="8000">
              <label class="toolbar-label">H</label>
              <input type="number" class="toolbar-input" id="canvasHeightInput" value="1080" min="100" max="8000">
              <button class="btn btn-small" id="canvasSizeApply">適用</button>
            </div>
          </div>
          <!-- 2. 背景 -->
          <div class="toolbar-section">
            <span class="toolbar-section-title">2. 背景</span>
            <div class="toolbar-section-body">
              <input type="color" class="toolbar-color" id="canvasBgColor" value="#ffffff">
              <button class="canvas-bg-swatch" data-color="#ffffff" title="白"><span class="bg-swatch-big">W</span><span class="bg-swatch-small">HITE</span></button>
              <button class="canvas-bg-swatch" data-color="#000000" title="黒"><span class="bg-swatch-big">B</span><span class="bg-swatch-small">LACK</span></button>
            </div>
          </div>
          <!-- 3. 追加 -->
          <div class="toolbar-section">
            <span class="toolbar-section-title">3. 追加</span>
            <div class="toolbar-section-body">
              <button class="btn" id="imageAddBtn" title="画像追加">+ 画像</button>
              <button class="btn" id="imageAddTextBtn" title="テキスト追加">+ 文字</button>
            </div>
          </div>
          <!-- 4. オブジェクト -->
          <div class="toolbar-section" id="imagePropsBar">
            <span class="toolbar-section-title">4. オブジェクト</span>
            <div class="toolbar-section-body">
              <button class="btn btn-ghost btn-small" id="propBringFront" title="前面へ" disabled>▲前面</button>
              <button class="btn btn-ghost btn-small" id="propSendBack" title="背面へ" disabled>▼背面</button>
              <button class="btn btn-ghost btn-small" id="propDeleteBtn" disabled>削除</button>
            </div>
          </div>
          <!-- 5. 描画ツール -->
          <div class="toolbar-section toolbar-draw-section">
            <span class="toolbar-section-title">5. 描画ツール</span>
            <div class="toolbar-section-body">
              <button class="btn tool-btn" id="imagePenBtn" data-tool="pen" title="ペンツール">ペン</button>
              <button class="btn tool-btn" id="imageGaussBtn" data-tool="gauss" title="ぼかしツール">ぼかし</button>
              <button class="btn tool-btn" id="imageMosaicBtn" data-tool="mosaic" title="モザイクツール">モザイク</button>
              <span class="toolbar-separator draw-sep" id="drawSep" hidden></span>
              <!-- ペン設定 -->
              <div class="tool-options-inline" id="penOptions" hidden>
                <label class="toolbar-label">太さ</label>
                <input type="range" class="toolbar-range" id="penSize" min="1" max="60" value="4">
                <span class="toolbar-range-val" id="penSizeVal">4</span>
                <label class="toolbar-label">色</label>
                <input type="color" class="toolbar-color" id="penColor" value="#ff0000">
              </div>
              <!-- ぼかし設定 -->
              <div class="tool-options-inline" id="gaussOptions" hidden>
                <label class="toolbar-label">太さ</label>
                <input type="range" class="toolbar-range" id="gaussBrushSize" min="5" max="80" value="30">
                <span class="toolbar-range-val" id="gaussBrushSizeVal">30</span>
                <label class="toolbar-label">強さ</label>
                <input type="range" class="toolbar-range" id="gaussEffectSize" min="2" max="40" value="7">
                <span class="toolbar-range-val" id="gaussEffectSizeVal">7</span>
              </div>
              <!-- モザイク設定 -->
              <div class="tool-options-inline" id="mosaicOptions" hidden>
                <label class="toolbar-label">太さ</label>
                <input type="range" class="toolbar-range" id="mosaicBrushSize" min="5" max="80" value="30">
                <span class="toolbar-range-val" id="mosaicBrushSizeVal">30</span>
                <label class="toolbar-label">粗さ</label>
                <input type="range" class="toolbar-range" id="mosaicEffectSize" min="2" max="40" value="7">
                <span class="toolbar-range-val" id="mosaicEffectSizeVal">7</span>
              </div>
            </div>
          </div>
          <!-- 6. 書き出し -->
          <div class="toolbar-section">
            <span class="toolbar-section-title">6. 書き出し</span>
            <div class="toolbar-section-body">
              <select class="select" id="imageFormat">
                <option value="png">PNG</option>
                <option value="jpeg">JPG</option>
              </select>
              <button class="btn" id="imageExportBtn">書き出し</button>
              <button class="btn btn-ghost" id="imageResetBtn">リセット</button>
            </div>
          </div>
        </div>
        <div class="image-canvas-area" id="imageCanvasArea">
          <div class="image-bottom-bar">
            <div class="shortcut-hints">
              <span><kbd>E</kbd><kbd>+</kbd> 拡大</span>
              <span><kbd>Q</kbd><kbd>-</kbd> 縮小</span>
              <span><kbd>0</kbd> フィット</span>
              <span><kbd>Del</kbd> 削除</span>
            </div>
            <div class="image-zoom-bar">
              <button class="image-zoom-btn" id="imageZoomOut" title="縮小 (Q / -)">−</button>
              <span class="image-zoom-val" id="imageZoomVal">100%</span>
              <button class="image-zoom-btn" id="imageZoomIn" title="拡大 (E / +)">+</button>
              <button class="image-zoom-btn image-zoom-fit" id="imageZoomFit" title="フィット (0)">FIT</button>
            </div>
          </div>
          <div class="image-canvas-wrapper" id="imageCanvasWrapper">
            <canvas id="imageCanvas"></canvas>
            <div class="image-objects-layer" id="imageObjectsLayer"></div>
            <canvas id="imagePenCanvas"></canvas>
          </div>
        </div>
      </div>
    </section>

    <!-- MEMO Section -->
    <section class="section active" id="section-memo">
      <div class="memo-container">
        <div class="memo-sidebar" id="memoSidebar">
          <div class="memo-sidebar-header">
            <span class="memo-sidebar-title">タグ</span>
            <button class="btn" id="memoTagAddBtn">+</button>
          </div>
          <div class="memo-tag-list" id="memoTagList"></div>
          <div class="memo-sidebar-footer">
            <div class="backup-folder-row" id="backupFolderRow">
              <button class="backup-gear-btn" id="backupGearBtn" title="バックアップフォルダ設定">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
              </button>
              <span class="backup-folder-label">バックアップ先:</span>
              <span class="backup-folder-path" id="backupFolderPath">未設定</span>
            </div>
            <div class="backup-actions-row">
              <button class="btn btn-ghost btn-small" id="backupExportBtn">バックアップ</button>
              <button class="btn btn-ghost btn-small" id="backupImportBtn">復元</button>
            </div>
          </div>
        </div>
        <div class="memo-resize-handle" id="memoResizeHandle"></div>
        <div class="memo-content" id="memoContent">
          <div class="memo-content-header">
            <span class="memo-content-title" id="memoContentTitle">タグを選択</span>
            <div class="memo-content-header-actions">
              <button class="btn btn-ghost" id="memoEditModeBtn" hidden>編集</button>
              <button class="btn" id="memoAddBtn" hidden>+ 追加</button>
            </div>
          </div>
          <div class="memo-item-list" id="memoItemList"></div>
        </div>
      </div>
    </section>
  </main>

  <script src="js/app.js"></script>
  <script src="js/memo.js"></script>
  <script src="js/edit.js"></script>
  <script src="js/image.js"></script>
</body>
</html>
